<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>合并 API 演示</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;padding:24px;line-height:1.6;background:#f6f7fb;color:#222}
    h2{margin:24px 0 12px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:720px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .row{display:flex;gap:16px;align-items:center}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#2563eb;color:#fff;text-decoration:none;border:none;cursor:pointer}
    .btn.secondary{background:#111827}
    .status{font-weight:600}
    img{border:1px dashed #d1d5db;border-radius:8px;background:#f9fafb}
    input[type="number"],input[type="text"],select{padding:6px;border:1px solid #d1d5db;border-radius:8px}
    .nav{margin-bottom:16px}
  </style>
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="light" />
  <meta name="referrer" content="no-referrer" />
</head>
<body>
  <h1>合并 API 演示</h1>
  <div class="nav"><a href="/" class="btn secondary">返回首页</a></div>

  <div class="card">
    <h2>数学题验证码（合并）</h2>
    <div class="row" style="margin-bottom:8px">
      <img id="mathImg2" width="180" height="60" alt="数学题验证码" />
      <button class="btn" id="btnGenMath2">生成</button>
    </div>
    <div class="row">
      <input id="mathAnswer2" type="number" placeholder="请输入答案" />
      <button class="btn secondary" id="btnVerifyMath2">验证</button>
      <span class="status" id="mathStatus2"></span>
    </div>
  </div>

  <div class="card" style="margin-top:20px">
    <h2>字母数字验证码（合并）</h2>
    <div class="row" style="margin-bottom:8px">
      <img id="textImg2" width="180" height="60" alt="字母数字验证码" />
      <button class="btn" id="btnGenText2">生成</button>
    </div>
    <div class="row">
      <input id="textInput2" type="text" placeholder="不区分大小写" />
      <button class="btn secondary" id="btnVerifyText2">验证</button>
      <span class="status" id="textStatus2"></span>
    </div>
  </div>

  <script>
    const apiBase = ''
    let mathId2 = null
    let textId2 = null

    async function genMathCombined(){
      const res = await fetch(`${apiBase}/api/captcha/math/new-with-image`)
      const data = await res.json()
      mathId2 = data.id
      const img = document.getElementById('mathImg2')
      img.src = data.imageDataUrl
      document.getElementById('mathStatus2').textContent = ''
    }

    async function verifyMathCombined(){
      if(!mathId2) return
      const answer = parseInt(document.getElementById('mathAnswer2').value,10)
      const res = await fetch(`${apiBase}/api/captcha/math/verify`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:mathId2,answer})})
      const data = await res.json()
      document.getElementById('mathStatus2').textContent = data.success ? '验证通过' : '答案不正确'
      if(data.success){ mathId2 = null }
    }

    async function genTextCombined(){
      const res = await fetch(`${apiBase}/api/captcha/text/new-with-image`)
      const data = await res.json()
      textId2 = data.id
      const img = document.getElementById('textImg2')
      img.src = data.imageDataUrl
      document.getElementById('textStatus2').textContent = ''
    }

    async function verifyTextCombined(){
      if(!textId2) return
      const text = document.getElementById('textInput2').value
      const res = await fetch(`${apiBase}/api/captcha/text/verify`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:textId2,text})})
      const data = await res.json()
      document.getElementById('textStatus2').textContent = data.success ? '验证通过' : '文本不正确'
      if(data.success){ textId2 = null }
    }

    document.getElementById('btnGenMath2').addEventListener('click', genMathCombined)
    document.getElementById('btnVerifyMath2').addEventListener('click', verifyMathCombined)
    document.getElementById('btnGenText2').addEventListener('click', genTextCombined)
    document.getElementById('btnVerifyText2').addEventListener('click', verifyTextCombined)

    document.addEventListener('DOMContentLoaded', () => {
      genMathCombined()
      genTextCombined()
    })
  </script>
</body>
</html>